generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Product {
  id               Int             @id @default(autoincrement())
  name             String          @unique
  description      String
  productLots      ProductLot[]
}

model ProductLot {
  id                Int            @id @default(autoincrement())
  lotNumber         String         @unique
  internalReference String         @unique
  productName       String
  quantity          Int            @default(0)

  product           Product        @relation(fields: [productName], references: [name])
  inventoryRecords  Inventory[]
  activityLogs      Log[]  
}

model Warehouse {
  id               Int              @id @default(autoincrement())
  name             String           @unique
  inventoryBays    InventoryBay[]
}

model InventoryBay {
  id               Int              @id @default(autoincrement())
  name             String           @unique
  warehouseName    String
  maxUniqueLots    Int              @default(1)

  warehouse        Warehouse        @relation(fields: [warehouseName], references: [name])
  inventoryRecords Inventory[]      
  activityLogsFrom Log[]            @relation("FromLocation") 
  activityLogsTo   Log[]            @relation("ToLocation")  
}

model Inventory {
  id               Int              @id @default(autoincrement())
  lotNumber        String
  location         String
  quantity         Int
  createdAt        DateTime         @default(now())
  createdBy        String
  updatedAt        DateTime         @updatedAt
  updatedBy        String

  productLot       ProductLot       @relation(fields: [lotNumber], references: [lotNumber])
  inventoryBay     InventoryBay     @relation(fields: [location], references: [name])
}

model Log {
  id               Int              @id @default(autoincrement())
  fromLocation     String
  toLocation       String
  dateTime         DateTime         @default(now())
  userId           String
  lotNumber        String
  quantityMoved    Int
  comments         String           @default("")

  fromInventoryBay InventoryBay     @relation("FromLocation", fields: [fromLocation], references: [name])
  toInventoryBay   InventoryBay     @relation("ToLocation", fields: [toLocation], references: [name])
  productLot       ProductLot       @relation(fields: [lotNumber], references: [lotNumber])
}

